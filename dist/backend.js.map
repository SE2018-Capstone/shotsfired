{"version":3,"sources":["webpack:///webpack/bootstrap f8342c7eeb4e52ad312e","webpack:///./src/server/server.ts","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///external \"http\"","webpack:///external \"process\"","webpack:///./src/server/lobby-server.ts","webpack:///./src/core/game.ts","webpack:///./src/core/player.ts","webpack:///./src/core/entity.ts","webpack:///./src/core/event.ts","webpack:///./src/core/vector.ts","webpack:///./src/core/bullet.ts","webpack:///./src/core/wall.ts","webpack:///external \"lodash\"","webpack:///./src/server/server-interface.ts","webpack:///./src/server/game-server.ts","webpack:///external \"socket.io\"","webpack:///./src/client/client-interface.ts"],"names":[],"mappings":"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","file":"backend.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap f8342c7eeb4e52ad312e\n **/","import * as express from 'express';\nimport * as path from 'path';\nimport * as http from 'http';\nimport * as process from 'process';\nimport { LobbyServer } from './lobby-server';\nimport { GameServer } from './game-server';\n\nvar app = express();\nvar server = http.createServer(app);\n\napp.use(express.static(path.resolve(__dirname, '../')));\napp.get('/', function (req: express.Request, res: express.Response) {\n  res.sendFile(path.resolve(__dirname, '../index.html'));\n});\n\nserver.listen(process.env.PORT || 3000, function () {\n  console.log('Port given by process.env variable: ', process.env.PORT);\n  console.log('Listening on port ', process.env.PORT || 3000);\n});\n\nlet lobby = new LobbyServer(server, app, new GameServer(server));\napp.get('/join', (req: express.Request, res: express.Response) => lobby.joinRandom(req,res));\napp.get('/createprivate', (req: express.Request, res: express.Response) => lobby.createPrivate(req,res));\napp.get(/game\\/.+/, function (req: express.Request, res: express.Response) {\n  res.sendFile(path.resolve(__dirname, '../index.html'));\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/server.ts\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"process\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"process\"\n ** module id = 4\n ** module chunks = 0\n **/","import * as express from 'express';\nimport { Server }  from 'http';\nimport { GameServer } from './game-server';\nimport { Game } from '../core/game';\nimport { GAME_LOBBY_COUNTDOWN, GAME_CODE_LENGTH } from './server-interface';\n\nexport class LobbyServer {\n  server: Server;\n  app: express.Express;\n  gameStartTimer: number = null; // Timeout id\n  playersInRandLobby: number = 0; // Number of players sitting in random lobby\n  currentRandLobby: string; // Unique hash for lobby\n  gameServer: GameServer;\n\n  constructor(server: Server, app: express.Express, gameServer: GameServer) {\n    this.app = app;\n    this.server = server;\n    this.gameServer = gameServer;\n    this.refreshRandGame();\n  }\n\n  // Returns new lobby's hashcode\n  createNewLobby() : string {\n    const alphabet = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n    let code = \"\";\n    for (let i = 0; i < GAME_CODE_LENGTH; i++) {\n      code += alphabet[Math.floor(Math.random()*alphabet.length)];\n    }\n    return code;\n  }\n\n  joinRandom(req: express.Request, res: express.Response) {\n    this.playersInRandLobby += 1;\n    console.log(\"Players waiting for random game to start: \", this.playersInRandLobby);\n\n    this.resetTimer();\n    res.setHeader('Content-Type', 'application/json');\n    res.send({gameCode: this.currentRandLobby});\n    if (this.playersInRandLobby === Game.settings.maxPlayers) {\n      this.refreshRandGame();\n    } else if (this.playersInRandLobby >= Game.settings.minPlayers) {\n      this.gameStartTimer = setTimeout(this.startRandGamePrematurely.bind(this), GAME_LOBBY_COUNTDOWN);\n    }\n  }\n\n  createPrivate(req: express.Request, res: express.Response) {\n    res.setHeader('Content-Type', 'application/json');\n    res.send({gameCode: this.createNewLobby()});\n  }\n\n  resetTimer() {\n      if (this.gameStartTimer !== null) {\n        clearTimeout(this.gameStartTimer);\n      }\n      this.gameStartTimer = null;\n  }\n\n  refreshRandGame() {\n    this.resetTimer();\n    this.currentRandLobby = this.createNewLobby();\n    this.playersInRandLobby = 0;\n  }\n\n  startRandGamePrematurely() {\n    this.playersInRandLobby = this.gameServer.startGame(this.currentRandLobby);\n    if (this.playersInRandLobby >= Game.settings.minPlayers) {\n      this.refreshRandGame();\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/lobby-server.ts\n **/","import { Player, PlayerState, PlayerMovement } from './player';\nimport { Bullet, BulletState } from './bullet';\nimport { EntityState, Entity } from './entity';\nimport { WallState, MapCatalog, Wall, BorderWalls } from './wall';\nimport { Event } from './event';\nimport * as _ from 'lodash';\n\nexport interface InputFrame {\n  left: boolean;\n  right: boolean;\n  up: boolean;\n  down: boolean;\n  angle: number;\n  fired: boolean;\n  duration: number;\n  playerId: string;\n  timestamp: number; // Used for client-server synchronization\n};\n\nexport interface GameState {\n  world: {\n    width: number;\n    height: number;\n  };\n  entities: {\n    players: {[id:string]:PlayerState};\n    bullets: {[id:string]:BulletState};\n    walls: {[id:string]: WallState};\n  };\n  settings: {\n    minPlayers: number;\n    maxPlayers: number;\n  };\n  isFinished: boolean;\n  winner: string;\n};\n\nexport const WorldSize = { width: 960, height: 720 };\n\nconst defaultMap = MapCatalog[0].walls.concat(BorderWalls(WorldSize)).reduce((prev, wallData) => {\n  const wallEntity: WallState = Wall.init(wallData);\n  (prev as any)[wallEntity.id] = wallEntity;\n  return prev;\n}, {});\n\nexport class Game {\n  static settings = { minPlayers: 2, maxPlayers: 4 };\n  static init(overrides: any = {}) {\n    let defaults: GameState = {\n      settings: { minPlayers: Game.settings.minPlayers,\n                  maxPlayers: Game.settings.maxPlayers },\n      world: WorldSize,\n      entities: { players: {}, bullets: {}, walls: defaultMap },\n      isFinished: false,\n      winner: null,\n    };\n    return Object.assign(defaults, overrides) as GameState;\n  }\n\n  // Current issue is that the state that the parts base their\n  // information of is changing as they're all running, so behavior\n  // might change based on the order of iteration, which is bad.\n  // Immutability is the only way to fix this\n  static update(game: GameState, delta: number) {\n\n    let {players, bullets} = game.entities;\n\n    let events: Event[] = [];\n\n    Object.keys(game.entities).forEach(entityType => {\n      let entities = (game.entities as any)[entityType] as {[s: string]: EntityState};\n      Object.keys(entities).forEach(id => {\n        if (!entities[id].alive && entityType !== 'players') { delete entities[id]; }\n      });\n    });\n\n    // Consider putting all entities together\n    events = Object.keys(players).reduce((events, playerId) => {\n      return events.concat(Player.update(players[playerId], delta, game));\n    }, events);\n\n    events = Object.keys(bullets).reduce((events, bulletId) => {\n      return events.concat(Bullet.update(bullets[bulletId], delta, game));\n    }, events);\n\n    return events;\n  }\n\n  static applyInputs(state: GameState, inputs: InputFrame[]) {\n    const players = state.entities.players;\n\n    var events: Event[] = [];\n    inputs.forEach(input => {\n      if (!_.get(players[input.playerId], 'alive', null)) { return; }\n      events = events.concat(Player.applyInput(players[input.playerId], input, state));\n    });\n\n    return events;\n  }\n\n  static resolveEvents(game: GameState, events: Event[]) {\n    let allEntities: {[id:string]: EntityState} = Object.keys(game.entities).reduce((list, key) => {\n      Object.assign(list, (game.entities as any)[key]);\n      return list;\n    }, {});\n    let { walls, players }  = game.entities;\n\n    events.forEach(event => {\n      let sender = allEntities[event.initiator];\n      let receiver = allEntities[event.receptor];\n      switch(event.type) {\n        case 'COLLISION':\n          switch(sender.type) {\n            case 'player': Player.collideWith(sender as PlayerState, receiver, game); break;\n            case 'bullet': Bullet.collideWith(sender as BulletState, receiver, game); break;\n          }\n          break;\n        case 'SPAWN_BULLET':\n          switch(sender.type) {\n            case 'player':\n              let bullet = Bullet.spawnFrom(sender as PlayerState);\n              game.entities.bullets[bullet.id] = bullet;\n              break;\n          }\n          break;\n        case 'MOVEMENT':\n          if (sender) {\n            let movementData = event.data as PlayerMovement;\n            Player.move(sender as PlayerState, movementData.xVel, movementData.yVel);\n            let foundCollision = !!_.find(walls, wall => Entity.colliding(sender, wall))\n                  || !!_.find(players, (player, playerId) => Entity.colliding(sender, player) && sender.id !== playerId);\n            if (foundCollision) {\n              Player.move(sender as PlayerState, movementData.xVel*-1, movementData.yVel*-1);\n            }\n          }\n          break;\n      }\n    });\n  }\n\n  static setIsFinished(game: GameState) {\n    game.isFinished = !!game.winner || _.size(_.filter(game.entities.players, p => p.alive)) <= 1;\n    if (game.isFinished) { game.winner = game.winner || _.get(_.find(game.entities.players, p => p.alive), 'id', null); }\n  }\n\n  static getWinner(game: GameState) {\n    return game.winner;\n  }\n\n  static addPlayer(game: GameState) {\n    let player = Player.init();\n    let count = 0;\n    if (game.entities.players) {\n      count = Object.keys(game.entities.players).length;\n    }\n    player.pos = MapCatalog[0].startPositions[count];\n    game.entities.players[player.id] = player;\n    return player;\n  }\n\n  static removePlayer(game: GameState, playerId: string) {\n    delete game.entities.players[playerId];\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/game.ts\n **/","import { Entity, EntityState } from './entity';\nimport { InputFrame, GameState } from './game';\nimport { EventFactory } from './event';\n\nexport interface PlayerState extends EntityState {\n  health: number;\n  type: 'player';\n  gunCooldown: number;\n  lastFire: number;\n}\nexport interface PlayerMovement {\n  angle: number;\n  xVel: number;\n  yVel: number;\n}\n\nexport const GUNPOINT_OFFSETS = {\n  center: { x: 9, y: 9 },\n  distance: { x: 17, y: 10 },\n};\nconst INPUT_VEL = 200;\nexport class Player extends Entity {\n  static init(overrides: any = {}) {\n    return Object.assign(super.init(), {\n      health: 10,\n      gunCooldown: 200,\n      lastFire: 0,\n      type: 'player',\n    }, overrides) as PlayerState;\n  }\n\n  static update(player: PlayerState, delta: number, game: GameState) {\n    return super.update(player, delta, game);\n  }\n\n  public static applyInput(player: PlayerState, input: InputFrame, game: GameState) {\n    if (input.playerId !== player.id) { return; }\n\n    // Controls\n    const step = (input.duration / 1000) * INPUT_VEL;\n    const inputVel = {x: 0, y: 0};\n\n    if (input.up) { inputVel.y -= step; }\n    if (input.down) { inputVel.y += step; }\n    if (input.left) { inputVel.x -= step; }\n    if (input.right) { inputVel.x += step; }\n\n    player.orientation = input.angle;\n\n    // Movement are events to allow for collision\n    let events: any = [];\n    if (input.up || input.down || input.left || input.right) {\n      events.push(EventFactory.createEvent('MOVEMENT', player.id, null, {\n        xVel: inputVel.x,\n        yVel: inputVel.y,\n      }));\n    }\n\n     // TODO: Investigate whether this Date.now business messes up with server\n    if (input.fired && player.lastFire + player.gunCooldown < Date.now()) {\n      player.lastFire = Date.now();\n      events.push(EventFactory.createEvent('SPAWN_BULLET', player.id, null));\n    }\n    return events;\n  }\n\n  static move(player: PlayerState, xvel: number, yvel: number) {\n    if (player) {\n      player.pos.x += xvel;\n      player.pos.y += yvel;\n    }\n  }\n\n  static takeDamage(player: PlayerState, dmg: number) {\n    player.health = player.health - dmg;\n    if (player.health < 0) { player.alive = false; }\n  }\n\n  static collideWith(player: PlayerState, other: EntityState, game: GameState) {\n    return;\n  }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/player.ts\n **/","import { GameState } from './game';\nimport { Event, EventFactory } from './event';\nimport { Vec, Vector } from './vector';\nimport { WallState } from './wall';\n\nexport interface EntityState {\n  pos: Vector;\n  vel: Vector;\n  accel: Vector;\n  // inputVel: Vector; // The velocity due to user input\n  orientation: number; // angle in radians\n  radius: number; // Collision hitbox\n  id: string;\n  alive: boolean;\n  type: string;\n};\n\nlet lastId = 0;\n\nexport class Entity {\n  static init(overrides: any = {}) {\n    return Object.assign({\n      pos: {x: 640, y: 320},\n      vel: {x: 0, y: 0},\n      accel: {x: 0, y: 0},\n      orientation: 0,\n      radius: 10,\n      alive: true,\n      id: (\"\" + lastId++),\n    }, overrides);\n  }\n\n  static getEntities(game: GameState) {\n    return Object.keys(game.entities).reduce((fullList: Entity[], entityType: string) => {\n      let entities = (game.entities as any)[entityType];\n      return fullList.concat(Object.keys(entities).map(e => entities[e])) as Entity[];\n    }, []);\n  }\n\n  // TODO: Make this able to keep players running if they were running\n  // We need player input to be able to be inputted normally, but extrapolated when only simulated?\n  static update(entity: EntityState, delta: number, game: GameState) {\n    entity.vel = Vec.add(entity.vel, entity.accel);\n\n    entity.pos = Vec.add(entity.pos, Vec.mul(entity.vel, delta / 1000));\n\n    let events: Event[] = [];\n    Entity.getEntities(game).forEach((other: EntityState) => {\n      if (other.id !== entity.id && Entity.colliding(entity, other)) {\n        events.push(EventFactory.createEvent('COLLISION', entity.id, other.id, {}));\n      }\n    });\n    return events;\n  }\n\n  static colliding(a: EntityState, b: EntityState) {\n    let extraResult = false;\n      if (b.type === 'wall') { // This code is only here due to a weird typescript dependency error.\n        let other = a;\n        let wall = b as WallState;\n        if (other.pos.x > wall.pos.x && other.pos.x < wall.pos.x + wall.width &&\n        other.pos.y > wall.pos.y && other.pos.y < wall.pos.y + wall.height ) {\n          extraResult = true;\n        }\n        if (other.pos.x > wall.pos.x && other.pos.x < wall.pos.x &&\n          (other.pos.y + other.radius > wall.pos.y && other.pos.y + other.radius < wall.pos.y + wall.height ||\n          other.pos.y - other.radius > wall.pos.y && other.pos.y - other.radius < wall.pos.y + wall.height)) {\n            extraResult = true;\n        }\n        if (other.pos.y > wall.pos.y && other.pos.y < wall.pos.y &&\n          (other.pos.x + other.radius > wall.pos.x && other.pos.x + other.radius < wall.pos.x + wall.width ||\n          other.pos.x - other.radius > wall.pos.x && other.pos.x - other.radius < wall.pos.x + wall.width)) {\n            extraResult = true;\n        }\n      return extraResult;\n    }\n    return Vec.mag(Vec.subtract(a.pos, b.pos)) < a.radius + b.radius;\n  }\n\n  static interact(entity: EntityState, other: EntityState, state: GameState) {\n    return;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/entity.ts\n **/","export interface Event {\n  type: string;\n  initiator: string;\n  receptor: string;\n  data: any;\n}\n\nexport class EventFactory {\n  static createEvent(type: string, initiator: string, receptor: string, data: any = {}) {\n    return Object.assign({\n      type,\n      initiator,\n      receptor,\n      data: data,\n    }) as Event;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/event.ts\n **/","export interface Vector {\n  x: number;\n  y: number;\n}\n\n// TODO: Move this out probably\nexport class Vec {\n  static add (a: Vector, b: Vector) {\n    return {x: a.x + b.x, y: a.y + b.y} as Vector;\n  }\n\n  static create(x: number, y: number) {\n    return {x, y};\n  }\n\n  static subtract(a: Vector, b: Vector){\n    return Vec.add(a, {x: -b.x, y: -b.y});\n  }\n\n  static mul(v: Vector, scale: number) {\n    return {x: v.x * scale, y: v.y * scale};\n  }\n\n  static mag(v: Vector) {\n    return Math.sqrt(v.x * v.x + v.y * v.y);\n  }\n\n  static direction(angle: number) {\n    return {x: Math.cos(angle), y: Math.sin(angle)};\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/vector.ts\n **/","import { EntityState, Entity } from './entity';\nimport { GameState }  from './game';\nimport { Player, PlayerState, GUNPOINT_OFFSETS } from './player';\nimport { Vec } from './vector';\n\nexport interface BulletState extends EntityState {\n  damage: number;\n  source: string;\n  type: 'bullet';\n};\n\nconst BULLET_SPEED = 300;\nexport class Bullet extends Entity {\n\n  static init(overrides: any = {}) {\n    return Object.assign(super.init(), {\n      damage: 15,\n      source: null,\n      alive: true,\n      type: 'bullet',\n    }, overrides) as BulletState;\n  }\n\n  static update(bullet: BulletState, delta: number, game: GameState){\n    if (bullet.pos.x < 0 - bullet.radius\n       || bullet.pos.x > game.world.width + bullet.radius\n       || bullet.pos.y < 0 - bullet.radius\n       || bullet.pos.y > game.world.height + bullet.radius) {\n         bullet.alive = false;\n    }\n    return super.update(bullet, delta, game);\n  }\n\n  static collideWith(bullet: BulletState, other: EntityState, state: GameState) {\n    switch(other.type) {\n      case 'player':\n        other = other as PlayerState;\n        if (other.id !== bullet.source && bullet.alive) {\n          Player.takeDamage(other as PlayerState, bullet.damage);\n          bullet.alive = false;\n        }\n        break;\n      case 'wall':\n        bullet.alive = false;\n        break;\n    }\n  }\n\n  static spawnFrom(entity: EntityState) {\n    let base = Bullet.init();\n    base.source = entity.id;\n    let directionVector = Vec.direction(entity.orientation);\n    let { center, distance } = GUNPOINT_OFFSETS;\n    base.pos = {\n      x: entity.pos.x + distance.x*directionVector.x - distance.y * directionVector.y - center.x,\n      y: entity.pos.y + distance.y*directionVector.y + distance.y * directionVector.x - center.y,\n    };\n    base.vel = Vec.mul(directionVector, BULLET_SPEED);\n    return base;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/bullet.ts\n **/","import { Entity, EntityState } from './entity';\nimport { GameState } from './game';\nimport { Event } from './event';\n\nexport enum WallSprite {\n  BUNKER_1x2_1,\n  BUNKER_2x1_1,\n  BUNKER_2x1_2,\n  BUNKER_2x2_1,\n};\n\nexport interface WallState extends EntityState {\n  width: number;\n  height: number;\n  sprite: WallSprite;\n}\n\nexport class Wall extends Entity {\n  static init(overrides: any = {}) {\n    return Object.assign(super.init(), {\n      width: 200,\n      height: 200,\n      sprite: 'bunker_2x2_1',\n      type: 'wall',\n    }, overrides) as WallState;\n  }\n\n  static update(wall: WallState, delta: number, game: GameState){\n    let events: Event[] = [];\n    return events;\n  }\n\n  static collideWith(wall: WallState, other: EntityState, game: GameState) {\n    return;\n  }\n\n}\n\n// State for the backup data for a wall\nexport interface StoredWallState  {\n  pos: {\n    x: number;\n    y: number;\n  };\n  width: number;\n  height: number;\n  sprite: WallSprite;\n}\n\n// List of maps, stores the minimal amount of data needed so that\n// this could be moved into a JSON file to backup maps\nexport const MapCatalog = [{\n  walls: [\n    {pos: {x: 380, y: 260}, width: 200, height: 200, sprite: WallSprite.BUNKER_2x2_1},\n    {pos: {x: 170, y: 145}, width: 140, height: 70, sprite: WallSprite.BUNKER_2x1_1},\n    {pos: {x: 205, y: 470}, width: 70, height: 140, sprite: WallSprite.BUNKER_1x2_1},\n    {pos: {x: 650, y: 505}, width: 140, height: 70, sprite: WallSprite.BUNKER_2x1_2},\n    {pos: {x: 685, y: 110}, width: 70, height: 140, sprite: WallSprite.BUNKER_1x2_1},\n  ],\n  startPositions: [\n    {x: 30, y: 30},\n    {x: 930, y: 30},\n    {x: 30, y: 690},\n    {x: 930, y: 690},\n  ]\n}];\n\nfunction BorderWalls(worldsize : any) {\n  return [\n    {pos: {x: 0, y: worldsize.height}, width: 960, height: 50, sprite: WallSprite.BUNKER_2x1_2},\n    {pos: {x: 0, y: -50}, width: 960, height: 50, sprite: WallSprite.BUNKER_2x1_2},\n    {pos: {x: -50, y: 0}, width: 50, height: 720, sprite: WallSprite.BUNKER_2x1_2},\n    {pos: {x: worldsize.width, y: 0}, width: 50, height: 720, sprite: WallSprite.BUNKER_2x1_2},\n  ];\n}\n\nexport { BorderWalls };\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/core/wall.ts\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 13\n ** module chunks = 0\n **/","import { GameState } from '../core/game';\n\nexport const GAME_LOBBY_COUNTDOWN = 5000;\nexport const SEND_STATE_UPDATE = \"state update\";\nexport const NEW_PLAYER_JOINED = \"new player\";\nexport const START_GAME = \"start game\";\nexport const GAME_CODE_LENGTH = 5;\nexport interface StatePayload {\n  game: GameState;\n  timestamp: number;\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/server-interface.ts\n **/","import { GameState, Game, InputFrame } from '../core/game';\nimport { Server }  from 'http';\nimport * as SocketIO from 'socket.io';\nimport * as _ from 'lodash';\nimport { START_GAME, SEND_STATE_UPDATE, StatePayload, NEW_PLAYER_JOINED } from './server-interface';\nimport { SEND_FRAMES } from '../client/client-interface';\n\nconst TICKS_PER_SECOND = 60;\nconst DEV_DELAY = 0; // Delays the updates sent to clients to simulate slower connections\nexport class GameServer {\n  io: SocketIO.Server;\n  sockets: SocketIO.Socket[];\n  activeGames: Map<string,GameInstance> = new Map<string,GameInstance>(); // String is unique hash given by lobby-server\n\n  constructor(server: Server) {\n    this.io = SocketIO(server);\n    this.io.on('connection', this.onConnection.bind(this));\n  }\n\n  startGame(gameCode: string) : number {\n    return this.activeGames.get(gameCode).startGame();\n  }\n\n  onConnection(socket: SocketIO.Socket) {\n    const gameCode = socket.handshake.query.gamecode;\n    if (!(this.activeGames.get(gameCode))) {\n      this.activeGames.set(gameCode, new GameInstance(()=>this.onGameFinished(gameCode)));\n    }\n    this.activeGames.get(gameCode).addPlayer(socket);\n  }\n\n  onGameFinished(gameCode : string) {\n    this.activeGames.delete(gameCode);\n  }\n}\n\nclass GameInstance {\n  game: GameState;\n  sockets: SocketIO.Socket[] = [];\n  disconnects: string[] = [];\n  playerSockets: Map<string, SocketIO.Socket> = new Map();\n  gameFinishedCallback: ()=>void;\n  lastTick: number = 0;\n\n  // Keeps track of the timestamp of the latest input that the server has applied for each player\n  lastUpdateTimestamps: Map<SocketIO.Socket, number> = new Map();\n\n  // The unprocessed inputs for each player\n  frameBuffers: {[id:string]: InputFrame[]} = {};\n\n  constructor(gameFinishedCallback: ()=>void) {\n    this.gameFinishedCallback = gameFinishedCallback;\n    this.game = Game.init();\n    this.lastTick = Date.now();\n  }\n\n  addPlayer(socket: SocketIO.Socket) {\n    this.sockets.push(socket);\n    socket.on('disconnect', () => this.onDisconnection(socket));\n    if (this.sockets.length === Game.settings.maxPlayers) {\n      this.startGame();\n    }\n    for (let s of this.sockets) {\n      s.emit(NEW_PLAYER_JOINED, this.sockets.length);\n    }\n  }\n\n  startGame() : number {\n    if (this.sockets.length >= Game.settings.minPlayers) {\n      for (var socket of this.sockets) {\n        let player = Game.addPlayer(this.game);\n        socket.on(SEND_FRAMES, (frames: InputFrame[]) => this.acceptFrames(frames, player.id));\n        socket.on('disconnect', () => this.onInGameDisconnection(player.id));\n        socket.emit(START_GAME, {\n          playerId: player.id,\n          gameState: this.game,\n        });\n        this.playerSockets.set(player.id, socket);\n      }\n      this.tick();\n    } else {\n      // Can't start a game with < min players\n      for (let s of this.sockets) {\n        s.emit(NEW_PLAYER_JOINED, this.sockets.length);\n      }\n    }\n    return this.sockets.length;\n  }\n\n  onDisconnection(socket: SocketIO.Socket) {\n    this.sockets.splice(this.sockets.indexOf(socket), 1);\n    for (let s of this.sockets) {\n      s.emit(NEW_PLAYER_JOINED, this.sockets.length);\n    }\n  }\n\n  onInGameDisconnection(playerId: string) {\n    if (this.sockets.length <= 1) {\n      this.gameFinishedCallback();\n    }\n    this.disconnects.push(playerId);\n  }\n\n  tick() {\n    let {game, frameBuffers, disconnects, lastTick} = this;\n    let delta = Date.now() - lastTick;\n    this.lastTick += delta;\n\n    // Handle client disconnect\n    disconnects.forEach(id => Game.removePlayer(game, id));\n\n    // Update the \"most recent update\" timestamp for each player to\n    // inform it of how delayed its server payload is\n    _.forIn(frameBuffers, (frames, playerId) =>\n      this.lastUpdateTimestamps.set(this.playerSockets.get(playerId), _.last(frames).timestamp));\n\n    let frames = _.flatten(_.values(frameBuffers));\n    let events = Game.applyInputs(game, frames);\n    events = events.concat(Game.update(game, delta));\n    Game.resolveEvents(game, events);\n    this.sendState();\n    this.frameBuffers = {};\n    this.disconnects = [];\n    if (this.sockets.length > 0) {\n      // Don't call tick again if nobody is in the game anymore\n      setTimeout(this.tick.bind(this), (1/TICKS_PER_SECOND) * 1000);\n    }\n  }\n\n  acceptFrames(frames: InputFrame[], playerId: string) {\n    this.frameBuffers[playerId] = (this.frameBuffers[playerId] || []).concat(frames);\n  }\n\n  sendState() {\n    this.sockets.forEach((socket) => {\n      const payload: StatePayload = { // separate variable to ensure type adherence\n        game: _.cloneDeep(this.game), // Allows DEV_DELAY'd update to use old game TODO: Remove for prod\n        timestamp: this.lastUpdateTimestamps.get(socket) || 0,\n      };\n      setTimeout(() => { // Simulates slow connection, TODO: Remove for prod\n        socket.emit(SEND_STATE_UPDATE, payload);\n      }, DEV_DELAY);\n    });\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/server/game-server.ts\n **/","module.exports = require(\"socket.io\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"socket.io\"\n ** module id = 16\n ** module chunks = 0\n **/","export const SEND_FRAMES = \"new frames\";\n\n\n/** WEBPACK FOOTER **\n ** ./src/client/client-interface.ts\n **/"],"sourceRoot":""}